{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _get from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _classPrivateFieldInitSpec from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js\";\nimport _defineProperty from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _classPrivateFieldGet from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet.js\";\nimport _classPrivateFieldSet from \"C:/Users/Oguzhan/Desktop/BlockGuard/mwallet/node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet.js\";\nimport { defineProperties } from \"../utils/index.js\";\nimport { AbstractSigner } from \"./abstract-signer.js\";\nvar _noncePromise = /*#__PURE__*/new WeakMap();\nvar _delta = /*#__PURE__*/new WeakMap();\nexport var NonceManager = /*#__PURE__*/function (_AbstractSigner) {\n  _inherits(NonceManager, _AbstractSigner);\n  var _super = _createSuper(NonceManager);\n  function NonceManager(signer) {\n    var _this;\n    _classCallCheck(this, NonceManager);\n    _this = _super.call(this, signer.provider);\n    _defineProperty(_assertThisInitialized(_this), \"signer\", void 0);\n    _classPrivateFieldInitSpec(_assertThisInitialized(_this), _noncePromise, {\n      writable: true,\n      value: void 0\n    });\n    _classPrivateFieldInitSpec(_assertThisInitialized(_this), _delta, {\n      writable: true,\n      value: void 0\n    });\n    defineProperties(_assertThisInitialized(_this), {\n      signer: signer\n    });\n    _classPrivateFieldSet(_assertThisInitialized(_this), _noncePromise, null);\n    _classPrivateFieldSet(_assertThisInitialized(_this), _delta, 0);\n    return _this;\n  }\n  _createClass(NonceManager, [{\n    key: \"getAddress\",\n    value: function () {\n      var _getAddress = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              return _context.abrupt(\"return\", this.signer.getAddress());\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function getAddress() {\n        return _getAddress.apply(this, arguments);\n      }\n      return getAddress;\n    }()\n  }, {\n    key: \"connect\",\n    value: function connect(provider) {\n      return new NonceManager(this.signer.connect(provider));\n    }\n  }, {\n    key: \"getNonce\",\n    value: function () {\n      var _getNonce = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(blockTag) {\n        var delta;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(blockTag === \"pending\")) {\n                _context2.next = 8;\n                break;\n              }\n              if (_classPrivateFieldGet(this, _noncePromise) == null) {\n                _classPrivateFieldSet(this, _noncePromise, _get(_getPrototypeOf(NonceManager.prototype), \"getNonce\", this).call(this, \"pending\"));\n              }\n              delta = _classPrivateFieldGet(this, _delta);\n              _context2.next = 5;\n              return _classPrivateFieldGet(this, _noncePromise);\n            case 5:\n              _context2.t0 = _context2.sent;\n              _context2.t1 = delta;\n              return _context2.abrupt(\"return\", _context2.t0 + _context2.t1);\n            case 8:\n              return _context2.abrupt(\"return\", _get(_getPrototypeOf(NonceManager.prototype), \"getNonce\", this).call(this, blockTag));\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function getNonce(_x) {\n        return _getNonce.apply(this, arguments);\n      }\n      return getNonce;\n    }()\n  }, {\n    key: \"increment\",\n    value: function increment() {\n      var _this$delta, _this$delta2;\n      _classPrivateFieldSet(this, _delta, (_this$delta = _classPrivateFieldGet(this, _delta), _this$delta2 = _this$delta++, _this$delta)), _this$delta2;\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      _classPrivateFieldSet(this, _delta, 0);\n      _classPrivateFieldSet(this, _noncePromise, null);\n    }\n  }, {\n    key: \"sendTransaction\",\n    value: function () {\n      var _sendTransaction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(tx) {\n        var noncePromise;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              noncePromise = this.getNonce(\"pending\");\n              this.increment();\n              _context3.next = 4;\n              return this.signer.populateTransaction(tx);\n            case 4:\n              tx = _context3.sent;\n              _context3.next = 7;\n              return noncePromise;\n            case 7:\n              tx.nonce = _context3.sent;\n              _context3.next = 10;\n              return this.signer.sendTransaction(tx);\n            case 10:\n              return _context3.abrupt(\"return\", _context3.sent);\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function sendTransaction(_x2) {\n        return _sendTransaction.apply(this, arguments);\n      }\n      return sendTransaction;\n    }()\n  }, {\n    key: \"signTransaction\",\n    value: function signTransaction(tx) {\n      return this.signer.signTransaction(tx);\n    }\n  }, {\n    key: \"signMessage\",\n    value: function signMessage(message) {\n      return this.signer.signMessage(message);\n    }\n  }, {\n    key: \"signTypedData\",\n    value: function signTypedData(domain, types, value) {\n      return this.signer.signTypedData(domain, types, value);\n    }\n  }]);\n  return NonceManager;\n}(AbstractSigner);","map":{"version":3,"names":["defineProperties","AbstractSigner","_noncePromise","WeakMap","_delta","NonceManager","_AbstractSigner","_inherits","_super","_createSuper","signer","_this","_classCallCheck","call","provider","_defineProperty","_assertThisInitialized","_classPrivateFieldInitSpec","writable","value","_classPrivateFieldSet","_createClass","key","_getAddress","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","getAddress","stop","apply","arguments","connect","_getNonce","_callee2","blockTag","delta","_callee2$","_context2","_classPrivateFieldGet","_get","_getPrototypeOf","prototype","t0","sent","t1","getNonce","_x","increment","_this$delta","_this$delta2","reset","_sendTransaction","_callee3","tx","noncePromise","_callee3$","_context3","populateTransaction","nonce","sendTransaction","_x2","signTransaction","signMessage","message","signTypedData","domain","types"],"sources":["C:\\Users\\Oguzhan\\Desktop\\BlockGuard\\mwallet\\node_modules\\ethers\\src.ts\\providers\\signer-noncemanager.ts"],"sourcesContent":["import { defineProperties } from \"../utils/index.js\";\nimport { AbstractSigner } from \"./abstract-signer.js\";\n\nimport type { TypedDataDomain, TypedDataField } from \"../hash/index.js\";\n\nimport type {\n    BlockTag, Provider, TransactionRequest, TransactionResponse\n} from \"./provider.js\";\nimport type { Signer } from \"./signer.js\";\n\n\nexport class NonceManager extends AbstractSigner {\n    signer!: Signer;\n\n    #noncePromise: null | Promise<number>;\n    #delta: number;\n\n    constructor(signer: Signer) {\n        super(signer.provider);\n        defineProperties<NonceManager>(this, { signer });\n\n        this.#noncePromise = null;\n        this.#delta = 0;\n    }\n\n    async getAddress(): Promise<string> {\n        return this.signer.getAddress();\n    }\n\n    connect(provider: null | Provider): NonceManager {\n        return new NonceManager(this.signer.connect(provider));\n    }\n\n    async getNonce(blockTag?: BlockTag): Promise<number> {\n        if (blockTag === \"pending\") {\n            if (this.#noncePromise == null) {\n                this.#noncePromise = super.getNonce(\"pending\");\n            }\n\n            const delta = this.#delta;\n            return (await this.#noncePromise) + delta;\n        }\n\n        return super.getNonce(blockTag);\n    }\n\n    increment(): void {\n        this.#delta++;\n    }\n\n    reset(): void {\n        this.#delta = 0;\n        this.#noncePromise = null;\n    }\n\n    async sendTransaction(tx: TransactionRequest): Promise<TransactionResponse> {\n        const noncePromise = this.getNonce(\"pending\");\n        this.increment();\n\n        tx = await this.signer.populateTransaction(tx);\n        tx.nonce = await noncePromise;\n\n        // @TODO: Maybe handle interesting/recoverable errors?\n        // Like don't increment if the tx was certainly not sent\n        return await this.signer.sendTransaction(tx);\n    }\n\n    signTransaction(tx: TransactionRequest): Promise<string> {\n        return this.signer.signTransaction(tx);\n    }\n\n    signMessage(message: string | Uint8Array): Promise<string> {\n        return this.signer.signMessage(message);\n    }\n\n    signTypedData(domain: TypedDataDomain, types: Record<string, Array<TypedDataField>>, value: Record<string, any>): Promise<string> {\n        return this.signer.signTypedData(domain, types, value);\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}